### LightRAG Cloud Run Production Configuration with PostgreSQL
### Copy this file to .env and update with your actual values

###########################
### Server Configuration
###########################
HOST=0.0.0.0
PORT=9621
WEBUI_TITLE='My Graph KB'
WEBUI_DESCRIPTION="Simple and Fast Graph Based RAG System"
WORKERS=2
TIMEOUT=150
CORS_ORIGINS=*

### Logging level
LOG_LEVEL=INFO
VERBOSE=False

#####################################
### Login and API-Key Configuration
#####################################
AUTH_ACCOUNTS='admin:admin123,user1:pass456'
TOKEN_SECRET=Your-Key-For-LightRAG-API-Server-CHANGE-THIS
TOKEN_EXPIRE_HOURS=48
GUEST_TOKEN_EXPIRE_HOURS=24
JWT_ALGORITHM=HS256

### API-Key to access LightRAG Server API
LIGHTRAG_API_KEY=your-secure-api-key-here-CHANGE-THIS

######################################################################################
### Query Configuration
######################################################################################
ENABLE_LLM_CACHE=true
COSINE_THRESHOLD=0.2
TOP_K=40
CHUNK_TOP_K=20
MAX_ENTITY_TOKENS=6000
MAX_RELATION_TOKENS=8000
MAX_TOTAL_TOKENS=30000
KG_CHUNK_PICK_METHOD=VECTOR

#########################################################
### Reranking configuration (optional)
#########################################################
RERANK_BINDING=null
RERANK_BY_DEFAULT=False

########################################
### Document processing configuration
########################################
ENABLE_LLM_CACHE_FOR_EXTRACT=true
SUMMARY_LANGUAGE=English
ENTITY_TYPES='["Person", "Creature", "Organization", "Location", "Event", "Concept", "Method", "Content", "Data", "Artifact", "NaturalObject"]'
CHUNK_SIZE=1200
CHUNK_OVERLAP_SIZE=100
FORCE_LLM_SUMMARY_ON_MERGE=8
SUMMARY_MAX_TOKENS=1200
SUMMARY_LENGTH_RECOMMENDED_=600
SUMMARY_CONTEXT_SIZE=12000
MAX_SOURCE_IDS_PER_ENTITY=300
MAX_SOURCE_IDS_PER_RELATION=300
SOURCE_IDS_LIMIT_METHOD=FIFO
MAX_FILE_PATHS=100
RELATED_CHUNK_NUMBER=5

###############################
### Concurrency Configuration
###############################
MAX_ASYNC=4
MAX_PARALLEL_INSERT=2
EMBEDDING_FUNC_MAX_ASYNC=8
EMBEDDING_BATCH_NUM=10

###########################################################################
### LLM Configuration
### Update these with your actual LLM provider settings
###########################################################################
LLM_TIMEOUT=180

LLM_BINDING=openai
LLM_MODEL=gpt-4o-mini
LLM_BINDING_HOST=https://api.openai.com/v1
LLM_BINDING_API_KEY=<INSERT_YOUR_OPENAI_API_KEY>
OPENAI_LLM_MAX_COMPLETION_TOKENS=9000

### For Ollama (if using local LLM via external server)
# LLM_BINDING=ollama
# LLM_BINDING_HOST=http://your-ollama-server:11434
# LLM_MODEL=llama3.1:8b
# OLLAMA_LLM_NUM_CTX=32768
# OLLAMA_LLM_NUM_PREDICT=9000

#######################################################################################
### Embedding Configuration
### Update these with your actual embedding provider settings
#######################################################################################
EMBEDDING_TIMEOUT=30

EMBEDDING_BINDING=openai
EMBEDDING_MODEL=text-embedding-3-large
EMBEDDING_DIM=3072
EMBEDDING_SEND_DIM=false
EMBEDDING_TOKEN_LIMIT=8192
EMBEDDING_BINDING_HOST=https://api.openai.com/v1
EMBEDDING_BINDING_API_KEY=<INSERT_YOUR_OPENAI_API_KEY>

### For Ollama embeddings (if using local embeddings via external server)
# EMBEDDING_BINDING=ollama
# EMBEDDING_MODEL=bge-m3:latest
# EMBEDDING_DIM=1024
# EMBEDDING_BINDING_HOST=http://your-ollama-server:11434
# OLLAMA_EMBEDDING_NUM_CTX=8192

####################################################################
### WORKSPACE sets workspace name for all storage types
### Valid workspace name constraints: a-z, A-Z, 0-9, and _
####################################################################
WORKSPACE=production

############################
### CRITICAL: PostgreSQL Storage Configuration for Cloud Run
### This replaces the default file-based storage with persistent database storage
############################
LIGHTRAG_KV_STORAGE=PGKVStorage
LIGHTRAG_DOC_STATUS_STORAGE=PGDocStatusStorage
LIGHTRAG_GRAPH_STORAGE=PGGraphStorage
LIGHTRAG_VECTOR_STORAGE=PGVectorStorage

############################
### PostgreSQL Configuration
### UPDATE THESE WITH YOUR CLOUD SQL INSTANCE DETAILS
############################

### For Cloud SQL Proxy connection (recommended):
### Set POSTGRES_HOST to the Cloud SQL connection name when using Cloud SQL Proxy
### Format: /cloudsql/PROJECT_ID:REGION:INSTANCE_NAME
POSTGRES_HOST=<YOUR_CLOUD_SQL_PRIVATE_IP_OR_CONNECTION_NAME>

### For Private IP connection:
### Set POSTGRES_HOST to the private IP address (e.g., 10.x.x.x)
# POSTGRES_HOST=10.x.x.x

POSTGRES_PORT=5432
POSTGRES_USER=lightrag_user
POSTGRES_PASSWORD=<YOUR_SECURE_PASSWORD_HERE>
POSTGRES_DATABASE=lightrag
POSTGRES_MAX_CONNECTIONS=12

### PostgreSQL Vector Storage Configuration
### HNSW is recommended for production (best performance)
POSTGRES_VECTOR_INDEX_TYPE=HNSW
POSTGRES_HNSW_M=16
POSTGRES_HNSW_EF=200

### Alternative vector index types (uncomment if needed):
# POSTGRES_VECTOR_INDEX_TYPE=IVFFlat
# POSTGRES_IVFFLAT_LISTS=100

### PostgreSQL Connection Retry Configuration
### Provides network robustness for Cloud Run deployments
POSTGRES_CONNECTION_RETRIES=5
POSTGRES_CONNECTION_RETRY_BACKOFF=0.5
POSTGRES_CONNECTION_RETRY_BACKOFF_MAX=10.0
POSTGRES_POOL_CLOSE_TIMEOUT=5.0

### PostgreSQL SSL Configuration (recommended for production)
### Uncomment and configure if using SSL/TLS connections
# POSTGRES_SSL_MODE=require
# POSTGRES_SSL_CERT=/path/to/client-cert.pem
# POSTGRES_SSL_KEY=/path/to/client-key.pem
# POSTGRES_SSL_ROOT_CERT=/path/to/ca-cert.pem

### PostgreSQL Server Settings
### For Supabase or other managed PostgreSQL providers
# POSTGRES_SERVER_SETTINGS="options=reference%3D[project-ref]"

### Statement cache size (set to 0 to disable if needed)
POSTGRES_STATEMENT_CACHE_SIZE=100
